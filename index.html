<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Squad Battle - 20K DH</title>
    
    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
            color: #1e293b;
            padding: 10px;
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Login Styles */
        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .login-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 400px;
            width: 100%;
        }

        .login-title {
            font-size: 2rem;
            font-weight: 800;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .login-subtitle {
            color: #64748b;
            margin-bottom: 30px;
        }

        .profile-selection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .profile-option {
            padding: 20px;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .profile-option:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
        }

        .profile-option.selected {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        .profile-avatar-login {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #3b82f6;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            margin: 0 auto 10px;
        }

        .header {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            text-align: center;
            position: relative;
        }

        .user-info {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .current-user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #3b82f6;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .logout-btn {
            padding: 8px 15px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .main-title {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .prize-banner {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 1.5rem;
            font-weight: 700;
            display: inline-block;
            margin-top: 10px;
        }

        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 15px;
            padding: 8px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }

        .nav-tab {
            padding: 12px 20px;
            border-radius: 10px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-weight: 600;
            white-space: nowrap;
            transition: all 0.3s ease;
            flex: 1;
        }

        .nav-tab.active {
            background: #3b82f6;
            color: white;
        }

        .nav-tab:hover:not(.active) {
            background: #f1f5f9;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .progress-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .progress-circle {
            position: relative;
            width: 150px;
            height: 150px;
            margin: 0 auto 20px;
        }

        .circle-bg {
            fill: none;
            stroke: #f1f5f9;
            stroke-width: 8;
        }

        .circle-progress {
            fill: none;
            stroke: #3b82f6;
            stroke-width: 8;
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: center;
            transition: stroke-dashoffset 0.5s ease;
        }

        .percentage {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.8rem;
            font-weight: 700;
            color: #3b82f6;
        }

        .leaderboard {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .leaderboard-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
        }

        .player-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            margin: 10px 0;
            border-radius: 15px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .player-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
        }

        .player-card.rank-1 {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            border-color: #d97706;
        }

        .player-card.rank-2 {
            background: linear-gradient(135deg, #e5e7eb, #9ca3af);
            color: white;
            border-color: #6b7280;
        }

        .player-card.rank-3 {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            border-color: #b45309;
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .player-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #3b82f6;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
        }

        .player-stats {
            text-align: right;
        }

        .player-score {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .player-streak {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .profile-section {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .profile-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: #3b82f6;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            color: white;
            margin: 0 auto 15px;
        }

        .progress-tracker {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .tracker-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .metric-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: #3b82f6;
        }

        .metric-label {
            font-size: 0.9rem;
            color: #64748b;
            margin-top: 5px;
        }

        .check-in-section {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .check-in-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .check-in-btn {
            padding: 15px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-align: center;
        }

        .check-in-btn:hover {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        .check-in-btn.checked {
            background: #10b981;
            border-color: #10b981;
            color: white;
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .achievement-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .achievement-card.unlocked {
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            border-color: #10b981;
        }

        .achievement-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .social-feed {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .post {
            border-bottom: 1px solid #e2e8f0;
            padding: 20px 0;
        }

        .post:last-child {
            border-bottom: none;
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .post-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #3b82f6;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .ai-insights {
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            border: 2px solid #3b82f6;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .ai-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
            font-weight: 700;
            color: #1e40af;
            margin-bottom: 15px;
        }

        .challenge-card {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border: 2px solid #f59e0b;
            border-radius: 15px;
            padding: 20px;
            margin: 10px 0;
        }

        .challenge-title {
            font-weight: 700;
            color: #92400e;
            margin-bottom: 10px;
        }

        .input-group {
            margin: 15px 0;
        }

        .input-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            color: #374151;
        }

        .input-group input,
        .input-group select,
        .input-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
        }

        .input-group input:focus,
        .input-group select:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .streak-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 10px;
        }

        .streak-day {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .streak-day.completed {
            background: #10b981;
            color: white;
        }

        .photo-upload {
            border: 2px dashed #d1d5db;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .photo-upload:hover {
            border-color: #3b82f6;
            background: #f8fafc;
        }

        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .photo-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 12px;
            overflow: hidden;
            background: #f3f4f6;
        }

        .motivation-quote {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            font-style: italic;
            font-weight: 500;
            color: #92400e;
        }

        .hidden {
            display: none !important;
        }

        .firebase-status {
            position: fixed;
            top: 10px;
            left: 10px;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: bold;
            z-index: 1000;
        }

        .data-management {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
        }

        .data-btn {
            display: block;
            margin: 5px 0;
            padding: 8px 12px;
            background: #374151;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.3s;
        }

        .data-btn:hover {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .dashboard-grid,
            .profile-section {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                overflow-x: auto;
            }
            
            .tracker-grid {
                grid-template-columns: 1fr 1fr;
            }

            .profile-selection {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- LOGIN SCREEN -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <h1 class="login-title">üèÜ SQUAD BATTLE</h1>
            <p class="login-subtitle">S√©lectionnez votre profil pour continuer</p>
            
            <div class="profile-selection">
                <div class="profile-option" onclick="selectProfile('mehdi')">
                    <div class="profile-avatar-login">üî•</div>
                    <h3>MEHDI</h3>
                    <p>The Beast</p>
                </div>
                
                <div class="profile-option" onclick="selectProfile('anasse')">
                    <div class="profile-avatar-login">üí™</div>
                    <h3>ANASSE</h3>
                    <p>The Machine</p>
                </div>
                
                <div class="profile-option" onclick="selectProfile('bengram')">
                    <div class="profile-avatar-login">‚ö°</div>
                    <h3>BENGRAM</h3>
                    <p>The Lightning</p>
                </div>
                
                <div class="profile-option" onclick="selectProfile('imad')">
                    <div class="profile-avatar-login">üöÄ</div>
                    <h3>IMAD</h3>
                    <p>The Rocket</p>
                </div>
            </div>
            
            <button id="loginBtn" class="btn btn-primary" style="width: 100%; margin-top: 20px;" disabled onclick="login()">
                Entrer dans la bataille
            </button>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="mainApp" class="app-container hidden">
        <div class="header">
            <div class="user-info">
                <div class="current-user-avatar" id="currentUserAvatar">üî•</div>
                <span id="currentUserName">MEHDI</span>
                <button class="logout-btn" onclick="logout()">D√©connexion</button>
            </div>
            
            <h1 class="main-title">üèÜ ULTIMATE SQUAD BATTLE</h1>
            <div class="prize-banner">üí∞ 20,000 DH WINNER TAKES ALL</div>
            <div style="margin-top: 15px; color: #64748b;">
                <span id="globalProgress">9.6%</span> Complete ‚Ä¢ 
                <span id="daysRemaining">330</span> days left ‚Ä¢ 
                <span id="currentLeader">Mehdi</span> leading
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard')">üè† Dashboard</button>
            <button class="nav-tab" onclick="showTab('profiles')">üë• Profiles</button>
            <button class="nav-tab" onclick="showTab('leaderboard')">üèÜ Leaderboard</button>
            <button class="nav-tab" onclick="showTab('challenges')">‚ö° Challenges</button>
            <button class="nav-tab" onclick="showTab('social')">üí¨ Social</button>
            <button class="nav-tab" onclick="showTab('ai')">ü§ñ AI Coach</button>
        </div>

        <!-- DASHBOARD TAB -->
        <div id="dashboard" class="tab-content active">
            <div class="dashboard-grid">
                <div class="progress-card">
                    <h3>Global Progress</h3>
                    <div class="progress-circle">
                        <svg width="150" height="150">
                            <circle class="circle-bg" cx="75" cy="75" r="65"></circle>
                            <circle class="circle-progress" cx="75" cy="75" r="65" id="globalProgressCircle"></circle>
                        </svg>
                        <div class="percentage" id="globalPercentage">9.6%</div>
                    </div>
                    <p><strong>35</strong> days completed</p>
                </div>

                <div class="progress-card">
                    <h3>Quick Check-In</h3>
                    <div class="check-in-buttons">
                        <button class="check-in-btn" onclick="quickCheckIn('workout')">
                            üí™ Workout Done
                        </button>
                        <button class="check-in-btn" onclick="quickCheckIn('nutrition')">
                            ü•ó Good Nutrition
                        </button>
                        <button class="check-in-btn" onclick="quickCheckIn('sleep')">
                            üò¥ Good Sleep
                        </button>
                    </div>
                </div>
            </div>

            <div class="motivation-quote" id="dailyMotivation">
                "Today, you choose between 'I wish' and 'I will' - Choose wisely! üí™"
            </div>

            <div class="progress-tracker">
                <h3>Today's Team Stats</h3>
                <div class="tracker-grid">
                    <div class="metric-card">
                        <div class="metric-value" id="workoutsCompleted">3/4</div>
                        <div class="metric-label">Workouts Completed</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="dietOnTrack">2/4</div>
                        <div class="metric-label">Diet on Track</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="averageScore">67</div>
                        <div class="metric-label">Average Score</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="teamStreak">12</div>
                        <div class="metric-label">Team Streak</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PROFILES TAB -->
        <div id="profiles" class="tab-content">
            <div class="profile-section">
                <div class="profile-card" onclick="switchToProfile('mehdi')">
                    <div class="profile-avatar">üî•</div>
                    <h3>MEHDI</h3>
                    <p><strong>Score:</strong> <span id="mehdi-score">85</span>/100</p>
                    <p><strong>Streak:</strong> <span id="mehdi-streak">12</span> days</p>
                    <div class="streak-indicator">
                        <div class="streak-day completed">‚úì</div>
                        <div class="streak-day completed">‚úì</div>
                        <div class="streak-day completed">‚úì</div>
                        <div class="streak-day">‚Ä¢</div>
                        <div class="streak-day">‚Ä¢</div>
                    </div>
                </div>

                <div class="profile-card" onclick="switchToProfile('anasse')">
                    <div class="profile-avatar">üí™</div>
                    <h3>ANASSE</h3>
                    <p><strong>Score:</strong> <span id="anasse-score">78</span>/100</p>
                    <p><strong>Streak:</strong> <span id="anasse-streak">8</span> days</p>
                    <div class="streak-indicator">
                        <div class="streak-day completed">‚úì</div>
                        <div class="streak-day completed">‚úì</div>
                        <div class="streak-day">‚úó</div>
                        <div class="streak-day completed">‚úì</div>
                        <div class="streak-day">‚Ä¢</div>
                    </div>
                </div>

                <div class="profile-card" onclick="switchToProfile('bengram')">
                    <div class="profile-avatar">‚ö°</div>
                    <h3>BENGRAM</h3>
                    <p><strong>Score:</strong> <span id="bengram-score">72</span>/100</p>
                    <p><strong>Streak:</strong> <span id="bengram-streak">5</span> days</p>
                    <div class="streak-indicator">
                        <div class="streak-day completed">‚úì</div>
                        <div class="streak-day">‚úó</div>
                        <div class="streak-day completed">‚úì</div>
                        <div class="streak-day completed">‚úì</div>
                        <div class="streak-day">‚Ä¢</div>
                    </div>
                </div>

                <div class="profile-card" onclick="switchToProfile('imad')">
                    <div class="profile-avatar">üöÄ</div>
                    <h3>IMAD</h3>
                    <p><strong>Score:</strong> <span id="imad-score">81</span>/100</p>
                    <p><strong>Streak:</strong> <span id="imad-streak">10</span> days</p>
                    <div class="streak-indicator">
                        <div class="streak-day completed">‚úì</div>
                        <div class="streak-day completed">‚úì</div>
                        <div class="streak-day completed">‚úì</div>
                        <div class="streak-day completed">‚úì</div>
                        <div class="streak-day">‚Ä¢</div>
                    </div>
                </div>
            </div>

            <!-- Individual Profile Details -->
            <div class="progress-tracker">
                <h3>üìä Detailed Tracking</h3>
                <div class="input-group">
                    <label>Today's Weight (kg)</label>
                    <input type="number" id="weightInput" placeholder="Enter your weight">
                </div>
                <div class="input-group">
                    <label>Body Fat % (optional)</label>
                    <input type="number" id="bodyfatInput" placeholder="Enter body fat %">
                </div>
                <div class="input-group">
                    <label>Energy Level (1-10)</label>
                    <select id="energyInput">
                        <option value="">Select energy level</option>
                        <option value="1">1 - Exhausted</option>
                        <option value="5">5 - Average</option>
                        <option value="10">10 - Beast Mode</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="saveProgress()">Save Progress</button>
            </div>

            <!-- Photo Progress -->
            <div class="progress-tracker">
                <h3>üì∏ Photo Progress</h3>
                <div class="photo-upload" onclick="uploadPhoto()">
                    <div style="font-size: 3rem; margin-bottom: 10px;">üì∑</div>
                    <p>Click to upload progress photo</p>
                    <p style="font-size: 0.9rem; color: #6b7280;">Before/After, gym selfies, meals, etc.</p>
                </div>
                <div class="photo-grid" id="photoGrid">
                    <!-- Photos will be added here -->
                </div>
            </div>
        </div>

        <!-- LEADERBOARD TAB -->
        <div id="leaderboard" class="tab-content">
            <div class="leaderboard">
                <h2 class="leaderboard-title">üèÜ Live Rankings</h2>
                <div id="leaderboardContainer">
                    <!-- Leaderboard will be populated here -->
                </div>
            </div>

            <!-- Achievements -->
            <div class="progress-tracker">
                <h3>üèÖ Squad Achievements</h3>
                <div class="achievements-grid">
                    <div class="achievement-card unlocked">
                        <div class="achievement-icon">üî•</div>
                        <h4>First Week Warriors</h4>
                        <p>Complete first 7 days</p>
                    </div>
                    <div class="achievement-card unlocked">
                        <div class="achievement-icon">üí™</div>
                        <h4>Team Spirit</h4>
                        <p>All 4 members active same day</p>
                    </div>
                    <div class="achievement-card">
                        <div class="achievement-icon">‚≠ê</div>
                        <h4>25% Milestone</h4>
                        <p>Reach 25% (17 Sept)</p>
                    </div>
                    <div class="achievement-card">
                        <div class="achievement-icon">üöÄ</div>
                        <h4>No Excuses</h4>
                        <p>30-day team streak</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- CHALLENGES TAB -->
        <div id="challenges" class="tab-content">
            <div class="progress-tracker">
                <h3>‚ö° Active Challenges</h3>
                
                <div class="challenge-card">
                    <div class="challenge-title">üí™ Weekly Workout Challenge</div>
                    <p>Who can complete the most workouts this week?</p>
                    <div style="margin: 15px 0;">
                        <strong>Current Leader:</strong> Mehdi (5/7 workouts)
                    </div>
                    <div style="font-size: 0.9rem; color: #6b7280;">Ends: Sunday 11:59 PM</div>
                </div>

                <div class="challenge-card">
                    <div class="challenge-title">ü•ó Nutrition Consistency</div>
                    <p>Stay on track with your diet for 7 consecutive days</p>
                    <div style="margin: 15px 0;">
                        <strong>Progress:</strong> 3/7 days completed
                    </div>
                    <div style="font-size: 0.9rem; color: #6b7280;">Reward: Bonus 50 XP</div>
                </div>

                <div class="challenge-card">
                    <div class="challenge-title">üì∏ Progress Photo Challenge</div>
                    <p>Upload your best transformation photo this month</p>
                    <div style="margin: 15px 0;">
                        <strong>Participants:</strong> 2/4 submitted
                    </div>
                    <button class="btn btn-primary" onclick="uploadChallengePhoto()">Submit Photo</button>
                </div>
            </div>

            <div class="progress-tracker">
                <h3>üéØ Create New Challenge</h3>
                <div class="input-group">
                    <label>Challenge Title</label>
                    <input type="text" id="challengeTitle" placeholder="e.g. 10K Steps Daily Challenge">
                </div>
                <div class="input-group">
                    <label>Description</label>
                    <textarea id="challengeDesc" rows="3" placeholder="Describe the challenge..."></textarea>
                </div>
                <div class="input-group">
                    <label>Duration</label>
                    <select id="challengeDuration">
                        <option>1 Week</option>
                        <option>2 Weeks</option>
                        <option>1 Month</option>
                    </select>
                </div>
                <button class="btn btn-success" onclick="createChallenge()">Create Challenge</button>
            </div>
        </div>

        <!-- SOCIAL TAB -->
        <div id="social" class="tab-content">
            <div class="social-feed">
                <h3>üí¨ Squad Feed</h3>
                
                <!-- Post Input -->
                <div style="border-bottom: 1px solid #e2e8f0; padding-bottom: 20px; margin-bottom: 20px;">
                    <div class="input-group">
                        <textarea id="postInput" rows="3" placeholder="Share your progress, motivation, or struggles..."></textarea>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 10px;">
                        <button class="btn btn-primary" onclick="createPost()">üìù Post</button>
                        <button class="btn" onclick="addPhoto()" style="background: #10b981; color: white;">üì∑ Photo</button>
                        <button class="btn" onclick="shareWorkout()" style="background: #f59e0b; color: white;">üí™ Workout</button>
                    </div>
                </div>

                <!-- Posts Container -->
                <div id="postsContainer">
                    <!-- Posts will be populated from Firebase -->
                </div>
            </div>

            <!-- Accountability Section -->
            <div class="progress-tracker">
                <h3>üéØ Accountability Check</h3>
                <p style="margin-bottom: 20px;">Call out your squad members (friendly pressure!)</p>
                
                <div id="accountabilityContainer">
                    <!-- Will be populated based on user activity -->
                </div>
            </div>
        </div>

        <!-- AI COACH TAB -->
        <div id="ai" class="tab-content">
            <div class="ai-insights">
                <div class="ai-title">
                    ü§ñ AI Coach Analysis
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h4>üìä Performance Analysis</h4>
                    <p style="margin: 10px 0;">Based on your squad data, here's what I see:</p>
                    <div id="aiAnalysis">
                        <p>Loading analysis...</p>
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <h4>üéØ Weekly Predictions</h4>
                    <div style="background: white; padding: 15px; border-radius: 10px; margin-top: 10px;">
                        <p><strong>Win Probability (Based on current trends):</strong></p>
                        <div id="winProbability" style="margin: 10px 0;">
                            Loading predictions...
                        </div>
                        <p style="font-size: 0.9rem; color: #6b7280;">*Predictions based on consistency, progress rate, and momentum</p>
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <h4>üí° Smart Recommendations</h4>
                    <div style="background: white; padding: 15px; border-radius: 10px; margin-top: 10px;">
                        <p><strong>This Week's Focus:</strong></p>
                        <ul style="margin-left: 20px; line-height: 1.6;">
                            <li>Add 15min cardio after weights (all squad)</li>
                            <li>Increase protein to 2g per kg bodyweight</li>
                            <li>Track sleep quality for better recovery</li>
                            <li>Weekly progress photos for motivation</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- AI Chat -->
            <div class="progress-tracker">
                <h3>üí¨ Chat with AI Coach</h3>
                <div id="chatMessages" style="height: 300px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 10px; padding: 15px; background: #f8fafc; margin-bottom: 15px;">
                    <div style="margin-bottom: 15px;">
                        <strong>AI Coach:</strong> Hey squad! How can I help you optimize your training today? Ask me about nutrition, workouts, or motivation strategies! ü§ñüí™
                    </div>
                </div>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="chatInput" placeholder="Ask me anything about fitness, nutrition, or motivation..." style="flex: 1; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px;">
                    <button class="btn btn-primary" onclick="sendAIMessage()">Send</button>
                </div>
                
                <!-- Quick Questions -->
                <div style="margin-top: 15px;">
                    <p style="font-weight: 600; margin-bottom: 10px;">Quick Questions:</p>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                        <button class="btn" onclick="askAI('How can I break my plateau?')" style="background: #f3f4f6; color: #374151; font-size: 0.9rem;">Break Plateau?</button>
                        <button class="btn" onclick="askAI('Best post-workout meal?')" style="background: #f3f4f6; color: #374151; font-size: 0.9rem;">Post-workout meal?</button>
                        <button class="btn" onclick="askAI('How to stay motivated?')" style="background: #f3f4f6; color: #374151; font-size: 0.9rem;">Stay motivated?</button>
                        <button class="btn" onclick="askAI('Optimal rest time?')" style="background: #f3f4f6; color: #374151; font-size: 0.9rem;">Rest between sets?</button>
                    </div>
                </div>
            </div>

            <!-- Weekly Challenges from AI -->
            <div class="progress-tracker">
                <h3>üéØ AI-Generated Challenges</h3>
                <div class="challenge-card">
                    <div class="challenge-title">üß† Smart Challenge: Plateau Breaker</div>
                    <p>AI detected potential plateau. Try this new approach:</p>
                    <ul style="margin: 10px 0 10px 20px;">
                        <li>Increase reps by 2 for all exercises</li>
                        <li>Add 5min HIIT after each workout</li>
                        <li>Track energy levels for 7 days</li>
                    </ul>
                    <button class="btn btn-primary" onclick="acceptAIChallenge()">Accept Challenge</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration - Updated with your actual config
        const firebaseConfig = {
            apiKey: "AIzaSyBYXcm6oJNsTLnRyLB8hv7tmOCX6QOFTyw",
            authDomain: "fitness-tracker-eff06.firebaseapp.com",
            databaseURL: "https://fitness-tracker-eff06-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "fitness-tracker-eff06",
            storageBucket: "fitness-tracker-eff06.firebasestorage.app",
            messagingSenderId: "560968111406",
            appId: "1:560968111406:web:4544427ef3464cde3896bf",
            measurementId: "G-QCVWJM25GF"
        };

        // Initialize Firebase
        let isFirebaseConnected = false;
        let database = null;
        let firebaseListeners = [];

        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            isFirebaseConnected = true;
            console.log('üî• Firebase connected successfully!');
        } catch (error) {
            console.warn('‚ö†Ô∏è Firebase not configured properly:', error);
            isFirebaseConnected = false;
        }

        // Global data storage
        let squadData = {
            mehdi: { 
                name: 'MEHDI', 
                nickname: 'The Beast', 
                emoji: 'üî•', 
                score: 85, 
                streak: 12, 
                workouts: [], 
                weight: [], 
                photos: [], 
                checkIns: {},
                lastActive: new Date().toISOString(),
                isOnline: false
            },
            anasse: { 
                name: 'ANASSE', 
                nickname: 'The Machine', 
                emoji: 'üí™', 
                score: 78, 
                streak: 8, 
                workouts: [], 
                weight: [], 
                photos: [], 
                checkIns: {},
                lastActive: new Date().toISOString(),
                isOnline: false
            },
            bengram: { 
                name: 'BENGRAM', 
                nickname: 'The Lightning', 
                emoji: '‚ö°', 
                score: 72, 
                streak: 5, 
                workouts: [], 
                weight: [], 
                photos: [], 
                checkIns: {},
                lastActive: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
                isOnline: false
            },
            imad: { 
                name: 'IMAD', 
                nickname: 'The Rocket', 
                emoji: 'üöÄ', 
                score: 81, 
                streak: 10, 
                workouts: [], 
                weight: [], 
                photos: [], 
                checkIns: {},
                lastActive: new Date().toISOString(),
                isOnline: false
            }
        };

        let currentUser = null;
        let selectedProfile = null;
        let posts = [];
        let aiMessages = [];

        // Firebase functions
        function saveToFirebase(path, data) {
            if (!isFirebaseConnected) {
                showNotification('‚ö†Ô∏è Firebase not connected!', 'warning');
                return Promise.resolve();
            }

            return database.ref(path).set(data)
                .then(() => {
                    console.log(`üî• Data saved to Firebase: ${path}`);
                    showNotification('‚òÅÔ∏è Synced to cloud!', 'success');
                })
                .catch((error) => {
                    console.error('üî• Firebase save error:', error);
                    showNotification('‚ùå Failed to sync to cloud!', 'error');
                });
        }

        function loadFromFirebase() {
            if (!isFirebaseConnected) {
                showNotification('‚ö†Ô∏è Firebase not connected - using default data', 'warning');
                return;
            }

            // Load squad data
            database.ref('squadData').once('value')
                .then((snapshot) => {
                    if (snapshot.exists()) {
                        const firebaseData = snapshot.val();
                        // Merge with default data to ensure all properties exist
                        Object.keys(squadData).forEach(user => {
                            if (firebaseData[user]) {
                                squadData[user] = { ...squadData[user], ...firebaseData[user] };
                            }
                        });
                        updateDisplays();
                        console.log('‚úÖ Squad data loaded from Firebase');
                    }
                })
                .catch((error) => {
                    console.error('‚ùå Failed to load squad data:', error);
                });

            // Load posts
            database.ref('posts').once('value')
                .then((snapshot) => {
                    if (snapshot.exists()) {
                        const firebasePosts = snapshot.val();
                        posts = Object.values(firebasePosts).sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                        updateSocialFeedFromData();
                        console.log('‚úÖ Posts loaded from Firebase');
                    }
                })
                .catch((error) => {
                    console.error('‚ùå Failed to load posts:', error);
                });
        }

        function setupFirebaseListeners() {
            if (!isFirebaseConnected) return;

            // Listen for squad data changes
            const squadListener = database.ref('squadData').on('value', (snapshot) => {
                if (snapshot.exists()) {
                    const firebaseData = snapshot.val();
                    Object.keys(squadData).forEach(user => {
                        if (firebaseData[user]) {
                            squadData[user] = { ...squadData[user], ...firebaseData[user] };
                        }
                    });
                    updateDisplays();
                    updateLeaderboard();
                    updateAccountabilityCheck();
                }
            });

            // Listen for new posts
            const postsListener = database.ref('posts').on('value', (snapshot) => {
                if (snapshot.exists()) {
                    const firebasePosts = snapshot.val();
                    posts = Object.values(firebasePosts).sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    updateSocialFeedFromData();
                }
            });

            firebaseListeners.push(
                { ref: 'squadData', listener: squadListener },
                { ref: 'posts', listener: postsListener }
            );
        }

        function setUserOnline(userId, isOnline) {
            if (!isFirebaseConnected) return;

            squadData[userId].isOnline = isOnline;
            if (isOnline) {
                squadData[userId].lastActive = new Date().toISOString();
            }

            database.ref(`squadData/${userId}/isOnline`).set(isOnline);
            database.ref(`squadData/${userId}/lastActive`).set(squadData[userId].lastActive);
        }

        // Login functionality
        function selectProfile(profileId) {
            document.querySelectorAll('.profile-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            event.target.closest('.profile-option').classList.add('selected');
            selectedProfile = profileId;
            document.getElementById('loginBtn').disabled = false;
        }

        function login() {
            if (selectedProfile) {
                currentUser = selectedProfile;
                
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                
                updateCurrentUserDisplay();
                setUserOnline(currentUser, true);
                squadData[currentUser].lastActive = new Date().toISOString();
                
                if (isFirebaseConnected) {
                    saveToFirebase(`squadData/${currentUser}`, squadData[currentUser]);
                    setupFirebaseListeners();
                }
                
                loadUserData();
                showNotification(`Bienvenue ${squadData[currentUser].name}! üéâ`, 'success');
            }
        }

        function logout() {
            if (currentUser) {
                setUserOnline(currentUser, false);
                
                firebaseListeners.forEach(({ ref, listener }) => {
                    if (isFirebaseConnected) {
                        database.ref(ref).off('value', listener);
                    }
                });
                firebaseListeners = [];
            }
            
            currentUser = null;
            selectedProfile = null;
            
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
            
            document.querySelectorAll('.profile-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.getElementById('loginBtn').disabled = true;
            
            showNotification('D√©connect√© avec succ√®s! üëã', 'info');
        }

        function updateCurrentUserDisplay() {
            const userData = squadData[currentUser];
            document.getElementById('currentUserAvatar').textContent = userData.emoji;
            document.getElementById('currentUserName').textContent = userData.name;
        }

        function loadUserData() {
            updateDashboardStats();
            updateProfileScores();
            updateLeaderboard();
            updateAccountabilityCheck();
            updateAIAnalysis();
        }

        // Tab navigation
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Quick check-in functionality
        function quickCheckIn(type) {
            const button = event.target;
            const today = new Date().toDateString();
            
            if (!squadData[currentUser].checkIns[today]) {
                squadData[currentUser].checkIns[today] = {};
            }
            
            if (squadData[currentUser].checkIns[today][type]) {
                delete squadData[currentUser].checkIns[today][type];
                button.classList.remove('checked');
                button.textContent = button.textContent.replace(' ‚úì', '');
                squadData[currentUser].score = Math.max(0, squadData[currentUser].score - 5);
            } else {
                squadData[currentUser].checkIns[today][type] = true;
                button.classList.add('checked');
                button.textContent += ' ‚úì';
                squadData[currentUser].score += 5;
                squadData[currentUser].lastActive = new Date().toISOString();
                updateStreak();
                showNotification(`Great job! +5 points for ${type}! üéâ`, 'success');
            }
            
            if (isFirebaseConnected) {
                saveToFirebase(`squadData/${currentUser}`, squadData[currentUser]);
            }
            updateDisplays();
        }

        function updateStreak() {
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            const todayStr = today.toDateString();
            const yesterdayStr = yesterday.toDateString();
            
            const todayCheckIns = squadData[currentUser].checkIns[todayStr];
            const yesterdayCheckIns = squadData[currentUser].checkIns[yesterdayStr];
            
            if (todayCheckIns && Object.keys(todayCheckIns).length > 0) {
                if (yesterdayCheckIns && Object.keys(yesterdayCheckIns).length > 0) {
                    squadData[currentUser].streak++;
                } else {
                    squadData[currentUser].streak = 1;
                }
            }
        }

        // Progress tracking
        function saveProgress() {
            const weight = document.getElementById('weightInput').value;
            const bodyfat = document.getElementById('bodyfatInput').value;
            const energy = document.getElementById('energyInput').value;
            
            if (weight) {
                const progressEntry = {
                    date: new Date().toISOString(),
                    weight: parseFloat(weight),
                    bodyfat: bodyfat ? parseFloat(bodyfat) : null,
                    energy: energy ? parseInt(energy) : null
                };
                
                squadData[currentUser].weight.push(progressEntry);
                squadData[currentUser].score += 3;
                squadData[currentUser].lastActive = new Date().toISOString();
                
                showNotification('Progress saved! +3 points! üìä', 'success');
                
                document.getElementById('weightInput').value = '';
                document.getElementById('bodyfatInput').value = '';
                document.getElementById('energyInput').value = '';
                
                if (isFirebaseConnected) {
                    saveToFirebase(`squadData/${currentUser}`, squadData[currentUser]);
                }
                updateDisplays();
            } else {
                showNotification('Please enter your weight first! ‚ö†Ô∏è', 'warning');
            }
        }

        function uploadPhoto() {
            const photoGrid = document.getElementById('photoGrid');
            const photoItem = document.createElement('div');
            photoItem.className = 'photo-item';
            photoItem.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #e5e7eb; color: #6b7280;">
                    üì∑ Photo ${photoGrid.children.length + 1}
                </div>
            `;
            photoGrid.appendChild(photoItem);
            
            squadData[currentUser].photos.push({
                date: new Date().toISOString(),
                id: Date.now()
            });
            
            squadData[currentUser].score += 10;
            squadData[currentUser].lastActive = new Date().toISOString();
            
            showNotification('Photo uploaded! +10 points! üì∏', 'success');
            
            if (isFirebaseConnected) {
                saveToFirebase(`squadData/${currentUser}`, squadData[currentUser]);
            }
            updateDisplays();
        }

        // Social features
        function createPost() {
            const postText = document.getElementById('postInput').value;
            if (postText.trim()) {
                const newPost = {
                    id: Date.now(),
                    author: currentUser,
                    authorName: squadData[currentUser].name,
                    authorEmoji: squadData[currentUser].emoji,
                    text: postText,
                    timestamp: new Date().toISOString(),
                    likes: 0,
                    comments: []
                };
                
                if (isFirebaseConnected) {
                    database.ref(`posts/${newPost.id}`).set(newPost);
                } else {
                    posts.unshift(newPost);
                    updateSocialFeedFromData();
                }
                
                document.getElementById('postInput').value = '';
                squadData[currentUser].score += 2;
                squadData[currentUser].lastActive = new Date().toISOString();
                
                showNotification('Post shared with the squad! +2 points! üìù', 'success');
                
                if (isFirebaseConnected) {
                    saveToFirebase(`squadData/${currentUser}`, squadData[currentUser]);
                }
                updateDisplays();
            }
        }

        function updateSocialFeedFromData() {
            const container = document.getElementById('postsContainer');
            container.innerHTML = '';
            
            posts.forEach(post => {
                const postElement = document.createElement('div');
                postElement.className = 'post';
                
                const timeAgo = getTimeAgo(new Date(post.timestamp));
                
                postElement.innerHTML = `
                    <div class="post-header">
                        <div class="post-avatar">${post.authorEmoji}</div>
                        <div>
                            <strong>${post.authorName}</strong>
                            <div style="font-size: 0.9rem; color: #6b7280;">${timeAgo}</div>
                        </div>
                    </div>
                    <div style="margin-bottom: 15px;">
                        ${post.text}
                    </div>
                    <div style="display: flex; gap: 15px; font-size: 0.9rem; color: #6b7280;">
                        <span onclick="likePost(${post.id})" style="cursor: pointer;">üëç Like (${post.likes})</span>
                        <span onclick="commentPost(${post.id})" style="cursor: pointer;">üí¨ Comment</span>
                        <span onclick="motivatePost(${post.id})" style="cursor: pointer;">üî• Motivate</span>
                    </div>
                `;
                container.appendChild(postElement);
            });
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diffInSeconds = Math.floor((now - date) / 1000);
            
            if (diffInSeconds < 60) return 'Just now';
            if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)}m ago`;
            if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)}h ago`;
            return `${Math.floor(diffInSeconds / 86400)}d ago`;
        }

        // Leaderboard
        function updateLeaderboard() {
            const container = document.getElementById('leaderboardContainer');
            const sortedUsers = Object.entries(squadData).sort((a, b) => b[1].score - a[1].score);
            
            container.innerHTML = '';
            
            sortedUsers.forEach(([userId, userData], index) => {
                const rank = index + 1;
                const rankClass = rank === 1 ? 'rank-1' : rank === 2 ? 'rank-2' : rank === 3 ? 'rank-3' : '';
                
                const playerCard = document.createElement('div');
                playerCard.className = `player-card ${rankClass}`;
                
                playerCard.innerHTML = `
                    <div class="player-info">
                        <div class="player-avatar">${userData.emoji}</div>
                        <div>
                            <h3>${userData.name}</h3>
                            <p>${userData.nickname}</p>
                            ${userData.isOnline ? '<div style="font-size: 0.8rem; color: #10b981;">üü¢ Online</div>' : ''}
                        </div>
                    </div>
                    <div class="player-stats">
                        <div class="player-score">${userData.score}</div>
                        <div class="player-streak">${userData.streak}-day streak</div>
                    </div>
                `;
                
                container.appendChild(playerCard);
            });
        }

        // Accountability check
        function updateAccountabilityCheck() {
            const container = document.getElementById('accountabilityContainer');
            container.innerHTML = '';
            
            Object.entries(squadData).forEach(([userId, userData]) => {
                if (userId === currentUser) return;
                
                const lastActive = new Date(userData.lastActive);
                const daysSinceActive = Math.floor((new Date() - lastActive) / (1000 * 60 * 60 * 24));
                
                const cardColor = daysSinceActive > 1 ? '#fef3c7' : '#d1fae5';
                const textColor = daysSinceActive > 1 ? '#92400e' : '#047857';
                const buttonColor = daysSinceActive > 1 ? '#f59e0b' : '#10b981';
                
                const accountabilityCard = document.createElement('div');
                accountabilityCard.style.cssText = `
                    text-align: center; 
                    padding: 20px; 
                    background: ${cardColor}; 
                    border-radius: 12px; 
                    margin: 10px;
                    display: inline-block;
                    min-width: 200px;
                `;
                
                accountabilityCard.innerHTML = `
                    <div style="font-size: 2rem; margin-bottom: 10px;">${userData.emoji}</div>
                    <strong>${userData.name}</strong>
                    <div style="font-size: 0.9rem; color: ${textColor}; margin-top: 5px;">
                        ${daysSinceActive > 1 ? `Last active: ${daysSinceActive} days ago` : 'Active today! üí™'}
                    </div>
                    <button class="btn" onclick="sendMotivation('${userId}')" style="margin-top: 10px; background: ${buttonColor}; color: white; font-size: 0.9rem;">
                        ${daysSinceActive > 1 ? 'üî• Motivate' : 'üëç Encourage'}
                    </button>
                `;
                
                container.appendChild(accountabilityCard);
            });
        }

        // AI features
        function updateAIAnalysis() {
            const analysisContainer = document.getElementById('aiAnalysis');
            const users = Object.values(squadData);
            
            analysisContainer.innerHTML = `
                <ul style="margin-left: 20px; line-height: 1.6;">
                    <li><strong>Mehdi:</strong> Excellent consistency! Your workout frequency is 94%. Consider adding more cardio for optimal fat loss.</li>
                    <li><strong>Imad:</strong> Strong nutrition game! Your meal consistency is impressive. Focus on progressive overload in the gym.</li>
                    <li><strong>Anasse:</strong> Good momentum building. Your energy levels correlate with sleep quality - prioritize 8+ hours.</li>
                    <li><strong>Bengram:</strong> Potential detected! You respond well to challenges. Set micro-goals for better consistency.</li>
                </ul>
            `;
            
            // Update win probability
            const sortedUsers = Object.entries(squadData).sort((a, b) => b[1].score - a[1].score);
            const total = sortedUsers.reduce((sum, [_, data]) => sum + data.score, 0);
            
            const probabilities = sortedUsers.map(([userId, data]) => {
                const probability = Math.round((data.score / total) * 100);
                return `${data.emoji} ${data.name}: ${probability}%`;
            });
            
            document.getElementById('winProbability').textContent = probabilities.join(' | ');
        }

        function sendAIMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (message) {
                addAIMessage('user', message);
                input.value = '';
                
                setTimeout(() => {
                    const response = generateAIResponse(message);
                    addAIMessage('ai', response);
                }, 1000);
            }
        }

        function askAI(question) {
            document.getElementById('chatInput').value = question;
            sendAIMessage();
        }

        function addAIMessage(sender, message) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.style.marginBottom = '15px';
            
            if (sender === 'user') {
                messageDiv.innerHTML = `<strong>${squadData[currentUser].name}:</strong> ${message}`;
            } else {
                messageDiv.innerHTML = `<strong>AI Coach:</strong> ${message}`;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function generateAIResponse(message) {
            const responses = {
                'plateau': `Hey ${squadData[currentUser].name}! To break a plateau, try: 1) Change rep ranges 2) Add new exercises 3) Increase training frequency 4) Adjust nutrition timing. Your body adapts quickly - keep it guessing! üí™`,
                'meal': `Perfect question ${squadData[currentUser].name}! Best post-workout meal: Protein + Carbs within 30min. Try: Chicken + rice, Greek yogurt + banana, or protein shake + oats. Aim for 20-30g protein! ü•ó`,
                'motivation': `${squadData[currentUser].name}, motivation tips: 1) Remember your WHY 2) Track small wins 3) Find an accountability partner 4) Celebrate progress 5) Focus on the process, not just results! You're currently rank ${getCurrentRank()} - keep pushing! üî•`,
                'rest': `Great question! Optimal rest: 2-3 minutes for compound exercises, 1-2 minutes for isolation. Listen to your body - when you can maintain intensity, you\'re ready! ‚è±Ô∏è`
            };
            
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('plateau')) return responses.plateau;
            if (lowerMessage.includes('meal') || lowerMessage.includes('food')) return responses.meal;
            if (lowerMessage.includes('motivat')) return responses.motivation;
            if (lowerMessage.includes('rest') || lowerMessage.includes('time')) return responses.rest;
            
            return `Great question ${squadData[currentUser].name}! Based on your current progress (${squadData[currentUser].score} points, ${squadData[currentUser].streak}-day streak), I recommend focusing on consistency and progressive overload. You're doing amazing! Keep pushing! üöÄ`;
        }

        function getCurrentRank() {
            const sortedUsers = Object.entries(squadData).sort((a, b) => b[1].score - a[1].score);
            const rank = sortedUsers.findIndex(([user, data]) => user === currentUser) + 1;
            return rank;
        }

        function acceptAIChallenge() {
            squadData[currentUser].score += 10;
            squadData[currentUser].lastActive = new Date().toISOString();
            showNotification('AI Challenge accepted! +10 points! ü§ñ', 'success');
            
            if (isFirebaseConnected) {
                saveToFirebase(`squadData/${currentUser}`, squadData[currentUser]);
            }
            updateDisplays();
        }

        // Challenge functions
        function createChallenge() {
            const title = document.getElementById('challengeTitle').value;
            const desc = document.getElementById('challengeDesc').value;
            const duration = document.getElementById('challengeDuration').value;
            
            if (title && desc) {
                showNotification(`Challenge "${title}" created! üéØ`, 'success');
                
                document.getElementById('challengeTitle').value = '';
                document.getElementById('challengeDesc').value = '';
                
                squadData[currentUser].score += 5;
                squadData[currentUser].lastActive = new Date().toISOString();
                
                if (isFirebaseConnected) {
                    saveToFirebase(`squadData/${currentUser}`, squadData[currentUser]);
                }
                updateDisplays();
            } else {
                showNotification('Please fill in title and description! ‚ö†Ô∏è', 'warning');
            }
        }

        function uploadChallengePhoto() {
            showNotification('Challenge photo uploaded! üì∏', 'success');
        }

        // Social interaction functions
        function likePost(postId) {
            showNotification('Liked! üëç', 'success');
        }

        function commentPost(postId) {
            const comment = prompt('Add a comment:');
            if (comment) {
                showNotification('Comment added! üí¨', 'success');
            }
        }

        function motivatePost(postId) {
            showNotification('Motivation sent! üî•', 'success');
        }

        function addPhoto() {
            showNotification('Photo feature coming soon! üì∑', 'info');
        }

        function shareWorkout() {
            const workouts = [
                "Just finished an epic chest and triceps session! üí™",
                "Deadlift day! Feeling stronger than ever! üî•",
                "Cardio done! 30 minutes of pure sweat! üèÉ‚Äç‚ôÇÔ∏è",
                "Leg day complete! Can barely walk! ü¶µ",
                "Full body workout in the books! üíØ"
            ];
            
            const randomWorkout = workouts[Math.floor(Math.random() * workouts.length)];
            document.getElementById('postInput').value = randomWorkout;
            showNotification('Workout shared! Now post it! üí™', 'info');
        }

        function sendMotivation(member) {
            squadData[currentUser].score += 1;
            squadData[currentUser].lastActive = new Date().toISOString();
            showNotification(`Motivation sent to ${squadData[member].name}! +1 point! üî•`, 'success');
            
            if (isFirebaseConnected) {
                saveToFirebase(`squadData/${currentUser}`, squadData[currentUser]);
            }
            updateDisplays();
        }

        function switchToProfile(profileId) {
            if (profileId !== currentUser) {
                showNotification(`Switched to view ${squadData[profileId].name}'s profile! üë§`, 'info');
            }
        }

        // Display update functions
        function updateProfileScores() {
            Object.keys(squadData).forEach(user => {
                const scoreElement = document.getElementById(`${user}-score`);
                const streakElement = document.getElementById(`${user}-streak`);
                
                if (scoreElement) scoreElement.textContent = squadData[user].score;
                if (streakElement) streakElement.textContent = squadData[user].streak;
            });
        }

        function updateDashboardStats() {
            const users = Object.values(squadData);
            const averageScore = Math.round(users.reduce((sum, user) => sum + user.score, 0) / users.length);
            const maxStreak = Math.max(...users.map(user => user.streak));
            
            document.getElementById('averageScore').textContent = averageScore;
            document.getElementById('teamStreak').textContent = maxStreak;
        }

        function updateDisplays() {
            if (!currentUser) return;
            
            // Update global progress
            const startDate = new Date('2025-06-01');
            const currentDate = new Date();
            const totalDays = 365;
            const completedDays = Math.ceil((currentDate - startDate) / (1000 * 60 * 60 * 24));
            const percentage = Math.max(0, Math.min(100, (completedDays / totalDays) * 100));
            
            document.getElementById('globalProgress').textContent = percentage.toFixed(1) + '%';
            document.getElementById('globalPercentage').textContent = percentage.toFixed(1) + '%';
            document.getElementById('daysRemaining').textContent = Math.max(0, totalDays - completedDays);
            
            // Update current leader
            const sortedUsers = Object.entries(squadData).sort((a, b) => b[1].score - a[1].score);
            document.getElementById('currentLeader').textContent = sortedUsers[0][1].name;
            
            // Update progress circle
            const circumference = 2 * Math.PI * 65;
            const progressCircle = document.getElementById('globalProgressCircle');
            const strokeDashoffset = circumference - (percentage / 100) * circumference;
            progressCircle.style.strokeDasharray = circumference;
            progressCircle.style.strokeDashoffset = strokeDashoffset;
            
            updateProfileScores();
            updateDashboardStats();
        }

        // Utility functions
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            
            const colors = {
                success: '#10b981',
                warning: '#f59e0b',
                error: '#ef4444',
                info: '#3b82f6'
            };
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${colors[type] || colors.success};
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 1000;
                animation: slideIn 0.3s ease;
                max-width: 300px;
                border-left: 4px solid rgba(255,255,255,0.3);
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function exportData() {
            const dataToExport = {
                squadData: squadData,
                posts: posts,
                exportDate: new Date().toISOString(),
                version: '2.0',
                firebaseEnabled: isFirebaseConnected
            };
            
            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `squad-battle-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('üì• Data exported successfully!', 'success');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            if (importedData.squadData && importedData.posts) {
                                squadData = importedData.squadData;
                                posts = importedData.posts;
                                
                                if (isFirebaseConnected) {
                                    saveToFirebase('squadData', squadData);
                                    saveToFirebase('posts', posts.reduce((acc, post) => {
                                        acc[post.id] = post;
                                        return acc;
                                    }, {}));
                                }
                                
                                updateDisplays();
                                updateSocialFeedFromData();
                                showNotification('üì§ Data imported successfully!', 'success');
                            } else {
                                showNotification('‚ö†Ô∏è Invalid data file format', 'warning');
                            }
                        } catch (error) {
                            showNotification('‚ùå Failed to import data', 'error');
                            console.error('Import error:', error);
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function clearAllData() {
            if (confirm('‚ö†Ô∏è This will delete ALL squad data permanently! Are you sure?')) {
                if (isFirebaseConnected) {
                    database.ref('squadData').remove();
                    database.ref('posts').remove();
                    showNotification('üî• Firebase data cleared!', 'warning');
                }
                
                Object.keys(squadData).forEach(user => {
                    squadData[user].score = 0;
                    squadData[user].streak = 0;
                    squadData[user].checkIns = {};
                    squadData[user].weight = [];
                    squadData[user].photos = [];
                });
                posts = [];
                
                location.reload();
            }
        }

        function showDataInfo() {
            const dataSize = JSON.stringify(squadData).length;
            const postCount = posts.length;
            const onlineUsers = Object.values(squadData).filter(user => user.isOnline).length;
            
            alert(`üìä Data Information:
            
${isFirebaseConnected ? 'üî• Firebase: Connected' : '‚ùå Firebase: Not Connected'}
üìè Data size: ${(dataSize / 1024).toFixed(2)} KB
üìù Posts: ${postCount}
üë• Users: ${Object.keys(squadData).length}
üü¢ Online: ${onlineUsers} users

${isFirebaseConnected ? '‚úÖ Real-time sync active' : '‚ö†Ô∏è No real-time sync - Firebase not configured'}`);
        }

        function testFirebaseConnection() {
            if (!isFirebaseConnected) {
                showNotification('Firebase not connected!', 'error');
                return;
            }
            
            showNotification('Testing Firebase connection...', 'info');
            
            database.ref('test').set({
                timestamp: new Date().toISOString(),
                user: currentUser || 'anonymous'
            }).then(() => {
                showNotification('üî• Firebase connection successful!', 'success');
                return database.ref('test').remove();
            }).catch((error) => {
                showNotification('‚ùå Firebase connection failed!', 'error');
                console.error('Firebase test error:', error);
            });
        }

        function showFirebaseSetup() {
            const setupInstructions = `
üî• Firebase Setup Instructions:

1. Go to https://console.firebase.google.com/
2. Create a new project
3. Enable Realtime Database
4. Set rules to: { "rules": { ".read": true, ".write": true } }
5. Copy your config from Project Settings > General > Web apps
6. Replace the firebaseConfig object in the HTML file

Your config should look like:
{
  apiKey: "your-actual-api-key",
  authDomain: "your-project.firebaseapp.com",
  databaseURL: "https://your-project-default-rtdb.firebaseio.com",
  projectId: "your-project-id",
  // ... other config
}

Then redeploy your HTML file!
            `;
            
            alert(setupInstructions);
        }

        // Daily motivations
        const dailyMotivations = [
            "Today, you choose between 'I wish' and 'I will' - Choose wisely! üí™",
            "Champions don't become champions in the ring - They're made in training! ü•ä",
            "Your only competition? The person you were yesterday! Beat him! üöÄ",
            "Success is the sum of small efforts repeated daily! Keep summing! ‚ûï",
            "Every workout is a deposit in your future self's bank account! üí∞",
            "The pain you feel today will be the strength you feel tomorrow! üî•",
            "Don't wish for it, work for it! The 20K DH is waiting! üíé",
            "Your body can stand almost anything. It's your mind you have to convince! üß†"
        ];

        function updateDailyMotivation() {
            const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
            const motivationIndex = dayOfYear % dailyMotivations.length;
            document.getElementById('dailyMotivation').textContent = dailyMotivations[motivationIndex];
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && document.activeElement.id === 'chatInput') {
                sendAIMessage();
            }
            
            if (e.key === 'Enter' && e.ctrlKey && document.activeElement.id === 'postInput') {
                createPost();
            }
        });

        // Initialize app
        function initApp() {
            updateDailyMotivation();
            
            // Load data from Firebase
            loadFromFirebase();
            
            // Add CSS animations
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
                
                .profile-option:hover {
                    transform: translateY(-3px);
                    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
                }
                
                .btn:hover {
                    transform: translateY(-1px);
                }
                
                .player-card:hover {
                    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
                }
                
                .data-management {
                    position: fixed;
                    bottom: 20px;
                    left: 20px;
                    z-index: 1000;
                }
                
                .data-btn {
                    display: block;
                    margin: 5px 0;
                    padding: 8px 12px;
                    background: ${isFirebaseConnected ? '#10b981' : '#374151'};
                    color: white;
                    border: none;
                    border-radius: 6px;
                    font-size: 0.8rem;
                    cursor: pointer;
                    opacity: 0.7;
                    transition: opacity 0.3s;
                }
                
                .data-btn:hover {
                    opacity: 1;
                }
                
                .firebase-status {
                    position: fixed;
                    top: 10px;
                    left: 10px;
                    padding: 5px 10px;
                    border-radius: 15px;
                    font-size: 0.7rem;
                    font-weight: bold;
                    z-index: 1000;
                    ${isFirebaseConnected ? 
                        'background: #10b981; color: white;' : 
                        'background: #f59e0b; color: white;'
                    }
                }
            `;
            document.head.appendChild(style);
            
            // Add Firebase connection status indicator
            const statusIndicator = document.createElement('div');
            statusIndicator.className = 'firebase-status';
            statusIndicator.textContent = isFirebaseConnected ? 'üî• LIVE' : '‚ö†Ô∏è OFFLINE';
            statusIndicator.title = isFirebaseConnected ? 
                'Connected to Firebase - Real-time sync active' : 
                'Firebase not connected - No real-time sync';
            document.body.appendChild(statusIndicator);
            
            // Add data management buttons
            const dataManagement = document.createElement('div');
            dataManagement.className = 'data-management';
            dataManagement.innerHTML = `
                <button class="data-btn" onclick="exportData()" title="Export all data">üì• Export</button>
                <button class="data-btn" onclick="importData()" title="Import data">üì§ Import</button>
                <button class="data-btn" onclick="clearAllData()" title="Clear all data">üóëÔ∏è Reset</button>
                <button class="data-btn" onclick="showDataInfo()" title="Data info">‚ÑπÔ∏è Info</button>
                ${isFirebaseConnected ? 
                    '<button class="data-btn" onclick="testFirebaseConnection()" title="Test connection">üî• Test</button>' : 
                    '<button class="data-btn" onclick="showFirebaseSetup()" title="Setup Firebase">‚öôÔ∏è Setup</button>'
                }
            `;
            document.body.appendChild(dataManagement);
        }

        // Real-time updates simulation (for when Firebase is not connected)
        function simulateRealTimeUpdates() {
            if (!isFirebaseConnected) {
                setInterval(() => {
                    if (currentUser) {
                        Object.keys(squadData).forEach(user => {
                            if (user !== currentUser && Math.random() < 0.05) {
                                squadData[user].score += Math.floor(Math.random() * 3);
                                if (squadData[user].score > 100) squadData[user].score = 100;
                            }
                        });
                        updateDisplays();
                    }
                }, 30000);
            }
        }

        // Start the app
        initApp();
        simulateRealTimeUpdates();
        
        // Update displays every hour
        setInterval(updateDisplays, 3600000);
        
        // Show welcome message
        setTimeout(() => {
            if (!currentUser) {
                showNotification(
                    isFirebaseConnected ? 
                    'üî• Firebase connected! Real-time sync ready!' : 
                    '‚ö†Ô∏è Firebase not configured. Add your config for real-time sync!', 
                    isFirebaseConnected ? 'success' : 'warning'
                );
            }
        }, 2000);

        // Handle page visibility changes for online status
        document.addEventListener('visibilitychange', () => {
            if (currentUser) {
                const isVisible = !document.hidden;
                setUserOnline(currentUser, isVisible);
                if (isVisible) {
                    squadData[currentUser].lastActive = new Date().toISOString();
                    if (isFirebaseConnected) {
                        saveToFirebase(`squadData/${currentUser}`, squadData[currentUser]);
                    }
                }
            }
        });

        // Handle page unload
        window.addEventListener('beforeunload', () => {
            if (currentUser) {
                setUserOnline(currentUser, false);
            }
        });
    </script>
</body>
</html>
