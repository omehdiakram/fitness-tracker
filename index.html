<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÿßŸÑÿ£ÿ®ÿ∑ÿßŸÑ - Daily Fitness Tracker</title>
    <link rel="stylesheet" href="styles.css">\
    <script>
    document.addEventListener('DOMContentLoaded', function () {
        const carousel = document.querySelector('.macro-guide-carousel');
        if (!carousel) return; // Prevent errors if on another page
        const slides = document.querySelectorAll('.carousel-slide');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const dotsContainer = document.querySelector('.carousel-dots');

        let currentIndex = 0;
        const totalSlides = slides.length;

        // Create dots
        for (let i = 0; i < totalSlides; i++) {
            const dot = document.createElement('span');
            dot.classList.add('dot');
            dot.addEventListener('click', () => goToSlide(i));
            dotsContainer.appendChild(dot);
        }
        const dots = document.querySelectorAll('.dot');

        function updateCarousel() {
            carousel.style.transform = `translateX(-${currentIndex * 100}%)`;
            
            // Update dots
            dots.forEach((dot, index) => {
                dot.classList.toggle('active', index === currentIndex);
            });

            // Update buttons
            prevBtn.disabled = currentIndex === 0;
            nextBtn.disabled = currentIndex === totalSlides - 1;
            
            // Change last button text
            if (currentIndex === totalSlides - 1) {
                nextBtn.textContent = "Let's Calculate!";
                nextBtn.onclick = () => {
                   const calculator = document.querySelector('.profile-macro-calculator');
                   if(calculator) calculator.scrollIntoView({ behavior: 'smooth' });
                };
            } else {
                nextBtn.textContent = "Next ‚Üí";
                nextBtn.onclick = () => goToSlide(currentIndex + 1);
            }
        }

        function goToSlide(index) {
            currentIndex = index;
            updateCarousel();
        }

        prevBtn.addEventListener('click', () => {
            if (currentIndex > 0) {
                goToSlide(currentIndex - 1);
            }
        });
        
        // Initial setup for next button
        nextBtn.onclick = () => goToSlide(currentIndex + 1);

        // Initialize
        updateCarousel();
    });
</script>
</head>
<body>
    <!-- Firebase Connection Status -->
    <div id="firebaseStatus" class="firebase-status">
        <span id="statusText">Initializing...</span>
    </div>

    <!-- Authentication Screen -->
    <div id="authContainer" class="auth-container">
        <div class="auth-card">
            <h1 class="auth-logo">ÿßŸÑÿ£ÿ®ÿ∑ÿßŸÑ</h1>
            <p class="auth-subtitle">20K DH Challenge</p>
            
            <!-- Login Form -->
            <div id="loginForm">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="loginEmail" placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="Enter your password">
                </div>
                <button class="btn" onclick="loginUser()">Sign In</button>
                <button class="btn btn-secondary" onclick="showRegisterForm()">Create Account</button>
                <div class="forgot-link-container center">
                    <a href="#" class="forgot-link" onclick="showResetPassword()">Forgot Password?</a>
                </div>
            </div>
            
            <!-- Register Form -->
            <div id="registerForm" class="hidden">
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input type="text" class="form-input" id="registerName" placeholder="Enter your full name">
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="registerEmail" placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="registerPassword" placeholder="Create a password">
                </div>
                <div class="form-group">
                    <label class="form-label">Squad Nickname</label>
                    <input type="text" class="form-input" id="registerNickname" placeholder="e.g., The Beast, The Machine">
                </div>
                <button class="btn" onclick="registerUser()">Create Account</button>
                <button class="btn btn-secondary" onclick="showLoginForm()">Back to Sign In</button>
            </div>
        </div>
    </div>

    <!-- Password Reset Modal -->
    <div class="modal-overlay" id="resetModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Reset Password</h3>
                <button class="modal-close" onclick="closeResetModal()">√ó</button>
            </div>
            <div class="form-group">
                <label class="form-label">Email Address</label>
                <input type="email" class="form-input" id="resetEmail" placeholder="Enter your email">
            </div>
            <button class="btn" onclick="sendPasswordReset()">Send Reset Link</button>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="app-container">
        <div class="header">
            <div class="header-content">
                <h1>ÿßŸÑÿ£ÿ®ÿ∑ÿßŸÑ</h1>
                <div class="header-stats">
                    <span>üí∞ Prize: 20,000 DH</span>
                    <span id="globalProgress">Progress: 9.6%</span>
                    <span id="daysRemaining">Days left: 330</span>
                    <span id="currentLeader">Leader: Loading...</span>
                </div>
            </div>
            <div class="user-menu">
                <div class="user-avatar" id="userAvatar">U</div>
                <span id="userName">User</span>
                <button class="btn btn-sm" onclick="signOut()">Sign Out</button>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard')">Today</button>
            <button class="nav-tab" onclick="showTab('profile')">Profile</button>
            <button class="nav-tab" onclick="showTab('chat')">Squad Chat</button>
            <button class="nav-tab" onclick="showTab('leaderboard')">Leaderboard</button>
            <button class="nav-tab" onclick="showTab('calculator')">Macros Calculator</button>
            <!-- ***** NEW BUTTON ADDED ***** -->
            <button class="nav-tab" onclick="showTab('measurements')">Body Measurements</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <!-- Daily Dashboard -->
            <div class="daily-dashboard">
                <div class="daily-header">
                    <div>
                        <div class="daily-title">Today's Challenge</div>
                        <div class="daily-date" id="todayDate"></div>
                    </div>
                    <div class="streak-indicator" id="streakIndicator">
                        <span id="streakCount">0</span>
                        <span class="streak-fire">üî•</span>
                    </div>
                </div>
                
                <div class="daily-progress">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>Daily Progress</span>
                        <span id="dailyProgressPercent">0%</span>
                    </div>
                    <div class="daily-progress-bar">
                        <div class="daily-progress-fill" id="dailyProgressFill" style="width: 0%"></div>
                    </div>
                </div>

                <div class="daily-metrics">
                    <div class="metric-card" onclick="toggleMetric('weight')">
                        <div class="metric-icon">‚öñÔ∏è</div>
                        <div class="metric-label">Weight (kg)</div>
                        <input type="number" class="metric-input" id="weightInput" placeholder="Enter weight" step="0.1">
                        <div class="metric-value" id="weightValue">-</div>
                    </div>
                    <div class="metric-card" onclick="toggleMetric('training')">
                        <div class="metric-icon">üí™</div>
                        <div class="metric-label">Training Done</div>
                        <div class="metric-checkbox">
                            <input type="checkbox" id="trainingCheck" onchange="updateDailyMetric('training', this.checked)">
                            <label for="trainingCheck">Completed</label>
                        </div>
                    </div>
                    <div class="metric-card" onclick="toggleMetric('mealprep')">
                        <div class="metric-icon">üç±</div>
                        <div class="metric-label">Meal Prep Done</div>
                        <div class="metric-checkbox">
                            <input type="checkbox" id="mealprepCheck" onchange="updateDailyMetric('mealprep', this.checked)">
                            <label for="mealprepCheck">Completed</label>
                        </div>
                    </div>
                    <div class="metric-card" onclick="toggleMetric('cardio')">
                        <div class="metric-icon">üèÉ</div>
                        <div class="metric-label">Cardio (min)</div>
                        <input type="number" class="metric-input" id="cardioInput" placeholder="Minutes" min="0">
                        <div class="metric-value" id="cardioValue">0</div>
                    </div>
                    <div class="metric-card" onclick="toggleMetric('protein')">
                        <div class="metric-icon">ü•©</div>
                        <div class="metric-label">Protein (g)</div>
                        <input type="number" class="metric-input" id="proteinInput" placeholder="Grams" min="0">
                        <div class="metric-value" id="proteinValue">0</div>
                    </div>
                    <div class="metric-card" onclick="toggleMetric('water')">
                        <div class="metric-icon">üíß</div>
                        <div class="metric-label">Water (L)</div>
                        <input type="number" class="metric-input" id="waterInput" placeholder="Liters" step="0.1" min="0">
                        <div class="metric-value" id="waterValue">0</div>
                    </div>
                    <div class="metric-card" onclick="toggleMetric('sleep')">
                        <div class="metric-icon">üò¥</div>
                        <div class="metric-label">Sleep (hrs)</div>
                        <input type="number" class="metric-input" id="sleepInput" placeholder="Hours" step="0.5" min="0" max="24">
                        <div class="metric-value" id="sleepValue">0</div>
                    </div>
                    <div class="metric-card" onclick="toggleMetric('mood')">
                        <div class="metric-icon">üòä</div>
                        <div class="metric-label">Mood/Energy</div>
                        <select class="metric-input" id="moodInput">
                            <option value="">Select</option>
                            <option value="great">üòÉ Great</option>
                            <option value="good">üôÇ Good</option>
                            <option value="ok">üòê OK</option>
                            <option value="tired">üò¥ Tired</option>
                            <option value="bad">üòû Bad</option>
                        </select>
                    </div>
                    <div class="metric-card" onclick="toggleMetric('carbs')">
                        <div class="metric-icon">üçö</div>
                        <div class="metric-label">Carbs (g)</div>
                        <input type="number" class="metric-input" id="carbsInput" placeholder="Grams" min="0">
                        <div class="metric-value" id="carbsValue">0</div>
                    </div>
                    <div class="metric-card" onclick="toggleMetric('fats')">
                        <div class="metric-icon">ü•ë</div>
                        <div class="metric-label">Fats (g)</div>
                        <input type="number" class="metric-input" id="fatsInput" placeholder="Grams" min="0">
                        <div class="metric-value" id="fatsValue">0</div>
                    </div>
                    <div class="metric-card" onclick="toggleMetric('calories')">
                        <div class="metric-icon">üî•</div>
                        <div class="metric-label">Calories</div>
                        <input type="number" class="metric-input" id="caloriesInput" placeholder="kcal" min="0">
                        <div class="metric-value" id="caloriesValue">0</div>
                    </div>
                </div>
                
                <div class="save-container">
                    <button class="save-btn" id="saveDailyBtn" onclick="saveDailyData()">
                        <span>üíæ</span> Save Today's Progress
                    </button>
                </div>
            </div>
            
            <!-- History Section -->
            <div class="history-container enhanced-history">
                <h3 class="card-title">üìù Your Daily Logs</h3>
                <div id="historyLogList" class="history-log-list">
                    <!-- Logs will be dynamically added here -->
                </div>
                <div class="history-details enhanced-details" id="historyDetails">
                    <div class="history-details-empty">
                        Select a day to view details
                    </div>
                </div>
            </div>
            
            <!-- Progress Chart -->
            <div class="card">
                <h3 class="card-title">üìà 30-Day Progress</h3>
                <div class="progress-chart" id="progressChart"></div>
            </div>
        </div>

        <!-- Profile Tab -->
        <div id="profile" class="tab-content">
            <div class="card profile-card">
                <!-- Profile Card (view only) -->
                <div class="profile-header">
                    <div class="profile-avatar" id="profileAvatar">U</div>
                    <div>
                        <div class="profile-name" id="profileName">User</div>
                        <div class="profile-nickname" id="profileNickname">Nickname</div>
                    </div>
                </div>
                <div class="profile-stats">
                    <div><div class="profile-stat-label">Current Streak</div><div class="profile-stat-value" id="profileStreak">0 üî•</div></div>
                    <div><div class="profile-stat-label">Best Streak</div><div class="profile-stat-value" id="profileBestStreak">0</div></div>
                    <div><div class="profile-stat-label">Weekly Avg Weight</div><div class="profile-stat-value" id="profileWeeklyAvg">-</div></div>
                    <div><div class="profile-stat-label">Total Points</div><div class="profile-stat-value" id="profilePoints">0</div></div>
                    <div><div class="profile-stat-label">Join Date</div><div class="profile-stat-value" id="profileJoinDate">-</div></div>
                    <div><div class="profile-stat-label">Height (cm)</div><div class="profile-stat-value" id="profileHeightDisplay">-</div></div>
                    <div><div class="profile-stat-label">BMI</div><div class="profile-stat-value" id="profileBMI">-</div></div>
                    <div><div class="profile-stat-label">Target Protein (g)</div><div class="profile-stat-value" id="profileProteinTarget">-</div></div>
                </div>
                <div class="profile-edit">
                    <h4>Edit Profile</h4>
                    <div class="profile-edit-fields">
                        <label>Name <input type="text" id="editProfileName"></label>
                        <label>Nickname <input type="text" id="editProfileNickname"></label>
                        <label>Height (cm) <input type="number" id="editProfileHeight" min="50" max="250" step="0.1"></label>
                        <button class="btn" id="saveProfileBtn">Save Changes</button>
                    </div>
                </div>
                <div class="profile-badges">
                    <h4>üèÖ Badges & Achievements</h4>
                    <div id="profileBadges">(Your badges will appear here)</div>
                </div>
                <div class="profile-reminders">
                    <h4>‚è∞ Reminders</h4>
                    <div id="profileReminders">(Set up reminders for logging, hydration, protein...)</div>
                </div>
                <div class="profile-streak-freeze">
                    <h4>üßä Streak Freeze</h4>
                    <div id="profileStreakFreeze">You have <span id="freezeCount">0</span> freeze(s) available. <button id="useFreezeBtn">Use Freeze</button></div>
                </div>
                <div class="profile-progress-graphs">
                    <h4>üìà Progress Graphs</h4>
                    <div id="profileGraphs">(Your progress charts will appear here)</div>
                </div>
                <div class="profile-reports">
                    <h4>üìä Weekly/Monthly Reports</h4>
                    <div id="profileReports">(Your reports will appear here)</div>
                </div>
                <div class="profile-extras">
                    <div class="profile-extra" id="profileConsistency">Consistency Score: <span>-</span></div>
                    <div class="profile-extra" id="profileDaysActive">Days Active: <span>-</span></div>
                    <div class="profile-extra" id="profileLongestStreak">Longest Streak: <span>-</span></div>
                </div>
            </div>
        </div>

        <!-- Macros Calculator Tab -->
        <div id="calculator" class="tab-content">
            <div class="macro-guide-container">
                <div class="macro-guide-carousel-wrapper" style="overflow: hidden;">
                    <div class="macro-guide-carousel">
                        <div class="carousel-slide">
                            <h3>Step 1: Your Personal Details</h3>
                            <p class="slide-subtitle">Let's start with the basics. Please use metric units for accuracy.</p>
                            <div class="slide-input-grid">
                                <label>Weight (kg)<br><input type="number" id="macroWeight" min="30" max="250" step="0.1" class="form-input"></label>
                                <label>Height (cm)<br><input type="number" id="macroHeight" min="100" max="250" step="0.1" class="form-input"></label>
                                <label>Age<br><input type="number" id="macroAge" min="10" max="100" class="form-input"></label>
                                <label>Body Fat (%)<br><input type="number" id="macroBodyFat" min="0" max="60" step="0.1" class="form-input"></label>
                            </div>
                        </div>
                        <div class="carousel-slide">
                            <h3>Step 2: Protein Intake</h3>
                            <p class="slide-subtitle">Use the sliding scale below to set your protein multiplier based on your body fat %.</p>
                            <div class="slide-content">
                                <div class="content-text">
                                    <h4>How to Choose:</h4>
                                    <p>If you have <strong>higher body fat</strong>, a multiplier closer to <strong>1.2</strong> is ideal.</p>
                                    <p>If you are <strong>leaner</strong>, aim for a value closer to <strong>1.6</strong> to preserve muscle.</p>
                                    <label><strong>Protein Multiplier (g/lb LBM)</strong><br>
                                    <input type="number" id="macroProteinMult" min="0.5" max="2.5" step="0.01" value="1.2" class="form-input">
                                    </label>
                                </div>
                                <div class="content-visual">
                                    <div class="protein-visual">
                                        <div class="protein-labels"><span>HIGH BODY FAT %</span><span>LOW BODY FAT %</span></div>
                                        <div class="arrow"></div>
                                        <div class="protein-values"><span>1.2 G/LB LBM</span><span>1.6 G/LB LBM</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="carousel-slide">
                            <h3>Step 3: Activity Level</h3>
                            <p class="slide-subtitle">Select a multiplier that reflects your daily activity outside of training.</p>
                            <div class="slide-content">
                                <div class="content-text">
                                    <h4>How to Choose:</h4>
                                    <p>Match your lifestyle to the descriptions in the table and enter a corresponding value.</p>
                                    <label><strong>Activity Multiplier</strong><br>
                                        <input type="number" id="macroActivity" min="1.1" max="2.5" step="0.01" value="1.5" class="form-input">
                                    </label>
                                </div>
                                <div class="content-visual">
                                    <table class="activity-table">
                                        <thead><tr><th>Lifestyle Example</th><th>Multiplier</th></tr></thead>
                                        <tbody>
                                            <tr><td>Desk job, little extra activity</td><td><strong>1.2 - 1.5</strong></td></tr>
                                            <tr><td>Desk job + daily walks</td><td><strong>1.5 - 1.8</strong></td></tr>
                                            <tr><td>Active job (e.g., waitress)</td><td><strong>1.8 - 2.0</strong></td></tr>
                                            <tr><td>Manual labor (e.g., construction)</td><td><strong>2.0 - 2.2</strong></td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="carousel-slide">
                            <h3>Step 4: Goals & Dietary Fat</h3>
                            <p class="slide-subtitle">Finally, let's set your fat intake and calorie deficit to match your goals.</p>
                            <div class="slide-input-grid grid-2-col">
                                <div class="input-card">
                                    <h4>Fat Percentage (%)</h4>
                                    <p>We recommend <strong>20-35%</strong> to support hormonal health. 25% is a great starting point.</p>
                                    <label><input type="number" id="macroFatPct" min="10" max="50" step="1" value="25" class="form-input"></label>
                                </div>
                                <div class="input-card">
                                    <h4>Deficit (%)</h4>
                                    <p>A <strong>0-10%</strong> deficit is good for recomposition. Use <strong>15-25%</strong> for focused fat loss.</p>
                                    <label><input type="number" id="macroDeficit" min="0" max="50" step="1" value="10" class="form-input"></label>
                                </div>
                            </div>
                        </div>
                        <div class="carousel-slide">
                            <h3>Final Step: Calculate Your Macros</h3>
                            <p class="slide-subtitle">One last check, and you're ready to see your results!</p>
                            <div class="final-check-box">
                                <label>
                                    <input type="checkbox" id="macroKatch"> 
                                    <strong>Use Katch-McArdle (Recommended)</strong>
                                </label>
                                <p>Check this box for the most accurate BMR calculation based on your Lean Body Mass.</p>
                            </div>
                            <div class="calculation-area">
                                <button class="btn btn-calculate" id="macroCalcBtn">Calculate My Macros</button>
                                <div id="macroCalcResult" class="macro-calc-result"></div>
                                <button class="btn btn-secondary btn-save" id="macroSaveBtn" style="display:none;">Save Macros to Profile</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="carousel-navigation">
                    <button class="nav-btn" id="prevBtn" disabled>‚Üê Previous</button>
                    <div class="carousel-dots"></div>
                    <button class="nav-btn" id="nextBtn">Next ‚Üí</button>
                </div>
            </div>
        </div>
        
<!-- ***** 4. NEW MEASUREMENTS TAB ADDED (AESTHETIC UPDATE) ***** -->
        <div id="measurements" class="tab-content">
            <div class="measurements-container">
                <!-- Left Side: Interactive Body Map -->
                <div class="measurements-interactive">
                    <h3 class="card-title futuristic-title"><span>Biometric Scanner</span></h3>
                    <div class="body-map-container">
                        <svg class="body-map-svg" viewBox="0 0 300 400" preserveAspectRatio="xMidYMid meet">
                            <!-- Background Grid -->
                            <defs>
                                <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
                                    <path d="M 20 0 L 0 0 0 20" fill="none" stroke="rgba(0, 242, 255, 0.1)" stroke-width="1"/>
                                </pattern>
                            </defs>
                            <rect width="100%" height="100%" fill="url(#grid)" />
                            
                            <!-- MODIFIED: SVG paths for a more muscular and aesthetic body shape -->
                            <g id="body-parts-group">
                                <!-- Neck -->
                                <path id="part-neck" class="body-part" data-target-input="measurement-neck" d="M140,75 L160,75 L165,90 L135,90 Z" />
                                <!-- Chest -->
                                <path id="part-chest" class="body-part" data-target-input="measurement-chest" d="M105,92 C 115,95 140,90 150,90 C 160,90 185,95 195,92 L 190,125 C 185,145 150,150 150,150 C 150,150 115,145 110,125 Z" />
                                <!-- Waist -->
                                <path id="part-waist" class="body-part" data-target-input="measurement-waist" d="M118,148 L182,148 Q 175,175 150,180 Q 125,175 118,148 Z" />
                                <!-- Hips -->
                                <path id="part-hips" class="body-part" data-target-input="measurement-hips" d="M115,180 L185,180 L175,210 L125,210 Z" />
                                <!-- Right Arm (Bicep) -->
                                <path id="part-arm-r" class="body-part" data-target-input="measurement-arm-r" d="M202,100 L220,110 Q 225,140 215,150 L200,140 Z" />
                                <!-- Left Arm (Bicep) -->
                                <path id="part-arm-l" class="body-part" data-target-input="measurement-arm-l" d="M98,100 L80,110 Q 75,140 85,150 L100,140 Z" />
                                <!-- Right Thigh (Quad) -->
                                <path id="part-thigh-r" class="body-part" data-target-input="measurement-thigh-r" d="M175,212 L152,212 L160,290 Q 180,295 190,285 Z" />
                                <!-- Left Thigh (Quad) -->
                                <path id="part-thigh-l" class="body-part" data-target-input="measurement-thigh-l" d="M125,212 L148,212 L140,290 Q 120,295 110,285 Z" />
                                <!-- Right Calf -->
                                <path id="part-calf-r" class="body-part" data-target-input="measurement-calf-r" d="M162,295 L185,360 L170,365 Q 155,330 162,295 Z" />
                                <!-- Left Calf -->
                                <path id="part-calf-l" class="body-part" data-target-input="measurement-calf-l" d="M138,295 L115,360 L130,365 Q 145,330 138,295 Z" />
                            </g>
                        </svg>
                        <!-- MODIFIED: Adjusted label positions for the new body shape -->
                        <div class="body-map-labels">
                            <span class="map-label" style="top: 21%; left: 50%;">Neck</span>
                            <span class="map-label" style="top: 30%; left: 50%;">Chest</span>
                            <span class="map-label" style="top: 33%; left: 25%;">L Arm</span>
                            <span class="map-label" style="top: 33%; left: 75%;">R Arm</span>
                            <span class="map-label" style="top: 41%; left: 50%;">Waist</span>
                            <span class="map-label" style="top: 50%; left: 50%;">Hips</span>
                            <span class="map-label" style="top: 65%; left: 35%;">L Thigh</span>
                            <span class="map-label" style="top: 65%; left: 65%;">R Thigh</span>
                            <span class="map-label" style="top: 85%; left: 35%;">L Calf</span>
                            <span class="map-label" style="top: 85%; left: 65%;">R Calf</span>
                        </div>
                    </div>
                </div>

                <!-- Right Side: Data Input & Progress (No changes here) -->
                <div class="measurements-data">
                    <div class="measurements-form card">
                        <div class="form-header">
                            <h4 class="form-title">Log Measurements <span class="unit">(cm)</span></h4>
                            <div id="measurementDate"></div>
                        </div>
                        <div class="form-grid">
                            <div class="input-group"><label for="measurement-neck">Neck</label><input type="number" class="measurement-input" id="measurement-neck" data-target-part="part-neck" placeholder="--.-" step="0.1"></div>
                            <div class="input-group"><label for="measurement-chest">Chest</label><input type="number" class="measurement-input" id="measurement-chest" data-target-part="part-chest" placeholder="--.-" step="0.1"></div>
                            <div class="input-group"><label for="measurement-arm-l">Left Arm</label><input type="number" class="measurement-input" id="measurement-arm-l" data-target-part="part-arm-l" placeholder="--.-" step="0.1"></div>
                            <div class="input-group"><label for="measurement-arm-r">Right Arm</label><input type="number" class="measurement-input" id="measurement-arm-r" data-target-part="part-arm-r" placeholder="--.-" step="0.1"></div>
                            <div class="input-group"><label for="measurement-waist">Waist</label><input type="number" class="measurement-input" id="measurement-waist" data-target-part="part-waist" placeholder="--.-" step="0.1"></div>
                            <div class="input-group"><label for="measurement-hips">Hips</label><input type="number" class="measurement-input" id="measurement-hips" data-target-part="part-hips" placeholder="--.-" step="0.1"></div>
                            <div class="input-group"><label for="measurement-thigh-l">Left Thigh</label><input type="number" class="measurement-input" id="measurement-thigh-l" data-target-part="part-thigh-l" placeholder="--.-" step="0.1"></div>
                            <div class="input-group"><label for="measurement-thigh-r">Right Thigh</label><input type="number" class="measurement-input" id="measurement-thigh-r" data-target-part="part-thigh-r" placeholder="--.-" step="0.1"></div>
                            <div class="input-group"><label for="measurement-calf-l">Left Calf</label><input type="number" class="measurement-input" id="measurement-calf-l" data-target-part="part-calf-l" placeholder="--.-" step="0.1"></div>
                            <div class="input-group"><label for="measurement-calf-r">Right Calf</label><input type="number" class="measurement-input" id="measurement-calf-r" data-target-part="part-calf-r" placeholder="--.-" step="0.1"></div>
                        </div>
                        <button class="btn save-measurements-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M7 19V13H17V19H19V11.83C19.0033 11.587 18.9047 11.3534 18.728 11.178L12.353 4.803C12.1583 4.60833 11.8417 4.60833 11.647 4.803L5.272 11.178C5.09533 11.3534 4.99667 11.587 5 11.83V19H7ZM5 21C4.45 21 3.979 20.804 3.587 20.412C3.195 20.02 3 19.55 3 19V11.83C3 11.2333 3.184 10.6957 3.552 10.217L9.927 3.842C10.517 3.252 11.2127 2.957 12 2.957C12.7873 2.957 13.483 3.252 14.073 3.842L20.448 10.217C20.816 10.6957 21 11.2333 21 11.83V19C21 19.55 20.804 20.02 20.412 20.412C20.02 20.804 19.55 21 19 21H5Z"/></svg>
                            Save Measurements
                        </button>
                    </div>
                    
                    <div class="measurements-progress card">
                        <h4 class="progress-title">Overall Development</h4>
                        <div class="radar-chart-container">
                            <div class="radar-placeholder">
                                <svg class="radar-bg" viewBox="0 0 100 100">
                                    <circle cx="50" cy="50" r="45" stroke="#00f2ff" stroke-opacity="0.2" fill="none"/>
                                    <circle cx="50" cy="50" r="30" stroke="#00f2ff" stroke-opacity="0.2" fill="none"/>
                                    <circle cx="50" cy="50" r="15" stroke="#00f2ff" stroke-opacity="0.2" fill="none"/>
                                </svg>
                                <p>Your progress radar will appear here after logging data.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <script>
            // Interactivity for the Body Measurements tab
            document.addEventListener('DOMContentLoaded', () => {
                const measurementsTab = document.getElementById('measurements');
                if (!measurementsTab) return;

                const bodyParts = measurementsTab.querySelectorAll('.body-part');
                const measurementInputs = measurementsTab.querySelectorAll('.measurement-input');

                const setActive = (element) => {
                    // Clear all active states first
                    bodyParts.forEach(p => p.classList.remove('active'));
                    measurementInputs.forEach(i => i.closest('.input-group').classList.remove('active'));

                    if (!element) return;

                    const isBodyPart = element.classList.contains('body-part');
                    const targetId = isBodyPart ? element.dataset.targetInput : element.dataset.targetPart;

                    const partToActivate = isBodyPart ? element : measurementsTab.querySelector(`#${targetId}`);
                    const inputToActivate = isBodyPart ? measurementsTab.querySelector(`#${targetId}`) : element;

                    if (partToActivate) partToActivate.classList.add('active');
                    if (inputToActivate) {
                        const inputGroup = inputToActivate.closest('.input-group');
                        if (inputGroup) inputGroup.classList.add('active');
                        // Focus the input if a body part was clicked
                        if (isBodyPart) inputToActivate.focus();
                    }
                };

                bodyParts.forEach(part => {
                    part.addEventListener('click', (e) => {
                        e.preventDefault();
                        setActive(part);
                    });
                });

                measurementInputs.forEach(input => {
                    input.addEventListener('focus', () => setActive(input));
                    input.addEventListener('blur', () => setActive(null)); // Optional: clear active state on blur
                });
                
                // Set current date
                const measurementDateEl = document.getElementById('measurementDate');
                if(measurementDateEl) {
                    measurementDateEl.textContent = new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
                }
            });
            </script>
        </div>
        <!-- End New Measurements Tab -->


        <!-- Chat Tab -->
        <div id="chat" class="tab-content">
            <div class="chat-container">
                <div class="chat-header">
                    <h3 class="card-title" style="margin: 0;">Squad Chat üí¨</h3>
                    <div style="font-size: 0.875rem; color: var(--text-secondary);">
                        <span id="onlineCount">0</span> members online
                    </div>
                </div>
                <div class="chat-online-users" id="chatOnlineUsers">
                    <!-- Online users will be listed here -->
                </div>
                <div class="chat-messages" id="chatMessages">
                    <!-- Messages will be dynamically added here -->
                </div>
                <div class="chat-typing-indicator" id="chatTypingIndicator" style="min-height: 24px; color: #888; font-style: italic; margin: 4px 0 0 8px;"></div>
                <div class="chat-input-container">
                    <textarea class="chat-input" id="chatInput" placeholder="Type your message..." rows="1"></textarea>
                    <button class="chat-send-btn" id="sendButton" onclick="sendMessage()">
                        <span>‚û§</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Leaderboard Tab -->
        <div id="leaderboard" class="tab-content">
            <div class="card">
                <h3 class="card-title">üèÜ Live Rankings</h3>
                <div id="leaderboardContainer">
                    <table class="leaderboard-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Nickname</th>
                                <th>Streak</th>
                                <th>Best Streak</th>
                                <th>Total Points</th>
                                <th>Weekly Avg Weight</th>
                                <th>BMI</th>
                                <th>Join Date</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboardBody">
                            <!-- Users will be dynamically added here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase v8 SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    <script src="app.js"></script>
</body>
</html>